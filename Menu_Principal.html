<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Menú de Series con Filtros</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8fafc;
      margin: 0;
      padding: 20px;
      color: #2d3748;
    }

    h1 {
      text-align: center;
      color: #1a365d;
      margin-bottom: 30px;
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
.header-container {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      margin-bottom: 20px;
      position: relative;
    }

    .header-container h1 {
      grid-column: 1;
      justify-self: center;
      width: 100%;
      text-align: center;
    }

    .btn-logout {
      grid-column: 2;
      padding: 10px 20px;
      background-color: #e53e3e;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .filtros {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      background-color: #1a365d;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .filtros input, .filtros select {
      padding: 12px 15px;
      font-size: 16px;
      border: 2px solid #4299e1;
      border-radius: 8px;
      background-color: #ffffff;
      color: #2d3748;
      min-width: 200px;
      transition: all 0.3s ease;
    }

    .filtros input:focus, .filtros select:focus {
      outline: none;
      border-color: #3182ce;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }

    .filtros input::placeholder {
      color: #a0aec0;
    }

    .series-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      padding: 20px;
    }

    .serie-card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: all 0.3s ease;
      border: 1px solid #e2e8f0;
    }

    .serie-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
    }

    .serie-card img {
      width: 100%;
      height: 350px;
      object-fit: cover;
      border-bottom: 4px solid #3182ce;
    }

    .serie-info {
      padding: 20px;
      text-align: center;
    }

    .serie-info h3 {
      margin: 10px 0 8px;
      font-size: 1.4rem;
      color: #1a365d;
      font-weight: 600;
    }

    .serie-info p {
      margin: 0;
      color: #4a5568;
      font-size: 1rem;
      font-weight: 500;
    }

    .btn-ver {
      margin-top: 15px;
      display: inline-block;
      padding: 10px 24px;
      background-color: #3182ce;
      color: white;
      border: none;
      border-radius: 8px;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-size: 0.9rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn-ver:hover {
      background-color: #2c5282;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    @media (max-width: 768px) {
      .filtros {
        flex-direction: column;
        align-items: center;
      }
      
      .filtros input, .filtros select {
        width: 100%;
      }
      
      .series-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .header-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .header-container h1 {
        grid-column: 1;
        order: 1;
      }

      .btn-logout {
        grid-column: 1;
        order: 2;
        justify-self: end;
      }
    }
  </style>
</head>
<body>
  <div class="header-container">
    <h1>Menú Principal de Series</h1>
    <a href="index.html" class="btn-logout">Cerrar sesión</a>
  </div>

  <div class="filtros">
    <select id="menuSeries">
      <option value="">Todas las series</option>
    </select>

    <input type="text" id="buscador" placeholder="Buscar por nombre parcial...">

    <select id="ordenar">
      <option value="az">Orden A-Z</option>
      <option value="za">Orden Z-A</option>
    </select>
  </div>

  <div class="series-grid" id="contenedorSeries"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB6MY2y5uyum87PdUHUpY8NNh4D73Yhx4U",
      authDomain: "animes-plus-89b93.firebaseapp.com",
      projectId: "animes-plus-89b93",
      storageBucket: "animes-plus-89b93.appspot.com",
      messagingSenderId: "402867181985",
      appId: "1:402867181985:web:d695b12977fe4270dbd3e0",
      measurementId: "G-DN632G7XJT"
    };


    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let todasLasSeries = [];
    let nombresUnicos = new Set();

    async function cargarSeries() {
      const snapshotSeries = await db.collection("animes-series-portadas").get();
      const datosTemporales = [];

      for (const docSerie of snapshotSeries.docs) {
        const nombreSerie = docSerie.id;
        nombresUnicos.add(nombreSerie);

        const snapshotTemporadas = await db.collection("animes-series-portadas")
          .doc(nombreSerie).collection("Temporadas").get();

        snapshotTemporadas.forEach(docTemporada => {
          const temporada = docTemporada.id;
          const data = docTemporada.data();
          const imagen = data.imagen || "https://via.placeholder.com/300x400?text=Sin+Imagen";
          const sitio = data.sitio02 || "#";

          datosTemporales.push({
            nombre: nombreSerie,
            temporada: temporada,
            imagen: imagen,
            sitio: sitio
          });
        });
      }

      todasLasSeries = datosTemporales;
      poblarMenuSeries();
      renderizarSeries();
    }

    function poblarMenuSeries() {
      const select = document.getElementById("menuSeries");
      [...nombresUnicos].sort().forEach(nombre => {
        const opcion = document.createElement("option");
        opcion.value = nombre;
        opcion.textContent = nombre;
        select.appendChild(opcion);
      });
    }

    function renderizarSeries() {
      const contenedor = document.getElementById("contenedorSeries");
      contenedor.innerHTML = "";

      const filtroNombre = document.getElementById("buscador").value.toLowerCase();
      const filtroSeleccionado = document.getElementById("menuSeries").value;
      const orden = document.getElementById("ordenar").value;

      let filtradas = todasLasSeries.filter(s => {
        const coincideTexto = s.nombre.toLowerCase().includes(filtroNombre);
        const coincideSeleccion = !filtroSeleccionado || s.nombre === filtroSeleccionado;
        return coincideTexto && coincideSeleccion;
      });

      filtradas.sort((a, b) => {
        if (orden === "az") return a.nombre.localeCompare(b.nombre);
        else return b.nombre.localeCompare(a.nombre);
      });

      filtradas.forEach(serie => {
        const card = document.createElement("div");
        card.className = "serie-card";
        card.innerHTML = `
          <img src="${serie.imagen}" alt="Portada de ${serie.nombre}">
          <div class="serie-info">
            <h3>${serie.nombre}</h3>
            <p>${serie.temporada}</p>
            <a class="btn-ver" href="${serie.sitio}" target="_blank">Ver</a>
          </div>
        `;
        contenedor.appendChild(card);
      });
    }

    // Escuchadores de filtros
    document.getElementById("buscador").addEventListener("input", renderizarSeries);
    document.getElementById("menuSeries").addEventListener("change", renderizarSeries);
    document.getElementById("ordenar").addEventListener("change", renderizarSeries);

    cargarSeries();
  </script>
</body>
</html>
